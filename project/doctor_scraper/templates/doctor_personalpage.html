<html>
<head>
    <title>Doctor Profile</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="card my-4">
                    <div class="card-body text-center">
                        <h1 id="doctor-name" class="card-title"></h1>
                        <img id="doctor-photo" src="" alt="Doctor's photo" class="img-fluid rounded-circle mb-4" />
                        <p id="doctor-specialty"></p>
                        <p id="doctor-location"></p>
                        <p id="doctor-phone"></p>
                        <p id="doctor-sub-specialty"></p>
                    </div>
                    <div class="btn-group">
                        <button onclick="showLocation()" class="btn btn-primary">Location</button>
                        <button onclick="showReviews()" class="btn btn-primary">Reviews</button>
                        <button onclick="showCV()" class="btn btn-primary">CV</button>
                    </div>
                </div>

                <div id="content" class="mt-4"></div>
            </div>
        </div>
    </div>
    <script>
        let doctorData;

        const doctorId = window.location.search.split('=')[1];
        fetch('http://127.0.0.1:8000/doctors/' + doctorId) // replace with your actual API endpoint
            .then(response => response.json())
            .then(data => {
                doctorData = data;
                console.log(doctorData)
                document.getElementById('doctor-name').textContent = data.name;
                document.getElementById('doctor-photo').src = data.photo ? data.photo : "https://www.chavanhospital.com/opd/dbimage/doctorprofile.png";
                document.getElementById('doctor-specialty').textContent = data.specialty;
                document.getElementById('doctor-experience').textContent = `Experience: ${data.experience} years`;
                document.getElementById('doctor-languages').textContent = `Languages: ${data.languages_spoken}`;
                document.getElementById('doctor-gender').textContent = `Gender: ${data.gender}`;
                string =doctorData.institution.location
             // Remove the square brackets and single quotes
            var cleanedString = string.replace(/[\[\]']/g, '');

            // Split the string by comma
            var values = cleanedString.split(',');

            // Extract latitude and longitude values
            var latitude = parseFloat(values[0]);
            var longitude = parseFloat(values[1]);
                document.getElementById('doctor-location').textContent = `Location: ${latitude}, ${longitude}`;
                document.getElementById('doctor-phone').textContent = `Phone: ${data.phone}`;
                document.getElementById('doctor-email').textContent = `Email: ${data.email}`;
                document.getElementById('doctor-sub-specialty').textContent = `Sub-specialty: ${data.sub_specialty}`;
           
            })
            .catch(error => console.error('Error:', error));

            function showCV() {
                console.log(doctorData);
    const contentDiv = document.getElementById('content');
    // Use the stored CV data
    let cv = doctorData.cv;
    let cvHTML = '<h2>CV</h2>';
    cvHTML += `<p><strong>Education:</strong> ${cv.educations}</p>`;
    cvHTML += `<p><strong>Experience:</strong> ${cv.experience}</p>`;
    cvHTML += `<p><strong>Awards:</strong> ${cv.awards}</p>`;
    cvHTML += `<p><strong>Publications:</strong> ${cv.publications}</p>`;
    contentDiv.innerHTML = cvHTML;
}
        function showLocation() {
            const contentDiv = document.getElementById('content');
             console.log(doctorData.institution.location);
            string =doctorData.institution.location
             // Remove the square brackets and single quotes
            var cleanedString = string.replace(/[\[\]']/g, '');

            // Split the string by comma
            var values = cleanedString.split(',');

            // Extract latitude and longitude values
            var latitude = parseFloat(values[0]);
            var longitude = parseFloat(values[1]);
            contentDiv.innerHTML = `<iframe 
                width="600" 
                height="450" 
                style="border:0" 
                loading="lazy" 
                allowfullscreen 
                src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBccZhxAfi7o-uUg3eq9avZDr5etH7xs_U&q=${encodeURIComponent(latitude + "," + longitude)}">
                </iframe>`;
        }

        function showReviews() {
            const contentDiv = document.getElementById('content');
            fetch(`http://127.0.0.1:8000/reviews/?doctor=${doctorData.id}`) // replace with your actual API endpoint
                .then(response => response.json())
                .then(reviews => {
                    console.log(reviews); // Check the type and structure of the reviews variable

                    let reviewsHTML = '<h2>Reviews</h2>';
                    reviews.forEach(review => {
                        reviewsHTML += `<p>${review.rating}/5 - ${review.review_text}</p>`;
                    });
                    contentDiv.innerHTML = reviewsHTML;
                })
                .catch(error => console.error('Error:', error));
        }

   
    </script>
</body>
</html>
